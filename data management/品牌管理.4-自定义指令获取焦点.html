<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script src="./lib/vue.min.js"></script>
    <link rel="stylesheet" href="./lib/bootstrap.min.css" />
  </head>
  <body>
    <div id="app">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">添加品牌</h3>
        </div>
        <div class="panel-body form-inline">
          <label>
            Id:
            <input type="text" class="form-control" v-model="id" />
          </label>

          <label>
            Name:
            <input
              type="text"
              class="form-control"
              v-model="name"
              @keyup.13="add"
            />
          </label>
          <input
            type="button"
            value="添加"
            class="btn btn-primary"
            @click="add"
          />

          <label>
            搜索关键字：
            <input
              type="text"
              class="form-control"
              v-model="keywards"
              v-focus
            />
          </label>
        </div>
      </div>

      <table class="table table-bordered table-hover table-striped">
        <thead>
          <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Ctime</th>
            <th>Operation</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="item in search(keywards)" :key="item.id">
            <!-- <tr v-for="item in list"></tr> -->
            <td>{{ item.id }}</td>
            <td>{{ item.name }}</td>
            <!-- <td v-text="item.ctime"></td> -->
            <td>{{ item.ctime | dateFormat }}</td>

            <td>{{ item.ctime | dateFormat('yyyy-MM-dD') }}</td>

            <!-- 注意给a取消默认事件 -->
            <td>
              <a href="" @click.prevent="del(item.id)">删除</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      Vue.directive('focus', {
        inserted: function(el) {
          //inserted 表示元素插入到DOM中时，就会执行inserted函数（触发一次）
          //这里参数 第一个又是固定的，永远是el，且表示被绑定的该指令的那个元素，
          //而且，这个el是原生DOM元素，即带有原生的一些方法，如 .focus()
          el.focus()
        }
      })
      Vue.filter('dateFormat', function(dateStr, pattern = '') {
        //给形参一个默认值，当不被传参时，不至于报错
        var dt = new Date(dateStr)
        //yyyy-mm-dd
        var y = dt.getFullYear()
        var m = (dt.getMonth() + 1).toString().padStart(2, '0')
        var d = dt
          .getDate()
          .toString()
          .padStart(2, '0')

        //return y + '-' + m + '-' + d

        if (pattern.toLowerCase() == 'yyyy-mm-dd') {
          return `${y}-${m}-${d}`
        } else {
          //否则返回详细时间
          var hh = dt
            .getHours()
            .toString()
            .padStart(2, '0')
          var mm = dt
            .getMinutes()
            .toString()
            .padStart(2, '0')
          var ss = dt
            .getSeconds()
            .toString()
            .padStart(2, '0')
          return `${y}-${m}-${d}  ${hh}：${mm}：${ss}`
        }
      })

      var vm = new Vue({
        el: '#app',
        data: {
          id: '',
          name: '',
          keywards: '',
          list: [
            { id: 1, name: '奔驰', ctime: new Date() },
            { id: 2, name: '宝马', ctime: new Date() },
            { id: 3, name: '玛莎拉蒂', ctime: new Date() }
          ]
        },
        methods: {
          add() {
            var car = { id: this.id, name: this.name, ctime: new Date() }
            this.list.push(car)
            // this.id = ''
            // this.name = ''
            this.id = this.name = ''
          },
          //   del(id) {
          //     this.list.some((item, i) => {
          //       //   console.log(id)
          //       if (item.id == id) {
          //         //第一次写的时候把它写成 this.id == id ,然后，del就无效了，循环都进不来
          //         // console.log(id, i)
          //         this.list.splice(i, 1)
          //         return true
          //       }
          //     })
          //   }
          del(id) {
            var index = this.list.findIndex(item => {
              //第一次写成 this.list.findIndex(item=> 然后 报错 index 未定义
              if (item.id == id) {
                return true
              }
            })
            this.list.splice(index, 1)
          },
          search(keywards) {
            // //这里用forEach循环遍历数组，找到包含关键字的item.name所在的item
            // var newList = []
            // this.list.forEach(item => {
            //   //注意：this不要丢了
            //   if (item.name.indexOf(keywards) != -1) {
            //     newList.push(item)
            //   }
            // })
            // return newList

            //这种方法调用filter筛选出符合条件的item拼成新的数组 search执行完整个结果 后return出去
            return this.list.filter(item => {
              if (item.name.indexOf(keywards) != -1) {
                return item
              }
            })
          }
        }
      })
    </script>
  </body>
</html>
